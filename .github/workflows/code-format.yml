name: code_format

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  format:
    # Set up operating system
    runs-on: ubuntu-latest

    # Define job steps
    steps:
    - name: Check-out repository
      uses: actions/checkout@v4

    - name: Build containers
      run: docker compose build

    - name: Install dependencies
      run: docker compose run --rm fe npm install

    - name: Format with prettier
      run: docker compose run --rm fe npx prettier . --write

    - name: Format with pre-commit
      uses: pre-commit/action@v3.0.1
      with:
        extra_args: --all-files

    - name: Commit any changes
      uses: stefanzweifel/git-auto-commit-action@v5
      id: auto-commit-action
      with:
        commit_message: Apply prettier/pre-commit changes

    - name: "Run if changes have been detected"
      if: steps.auto-commit-action.outputs.changes_detected == 'true'
      run: echo "Code changes!"

    - name: "Run if no changes have been detected"
      if: steps.auto-commit-action.outputs.changes_detected == 'false'
      run: echo "No code changes!"
